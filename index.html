<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Gestor de Salud Pro</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-FK92RC6VPR"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date);gtag("config","G-FK92RC6VPR")</script><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script><style>:root{--azul:#1e40af;--morado:#7e22ce;--fondo:#f8fafc;--rojo-fuerte:#dc2626;--rojo-suave:#fee2e2;--verde-ok:#16a34a;--amarillo:#fef9c3;--gris:#64748b;--naranja:#f59e0b}*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Arial,sans-serif}body{background:var(--fondo);padding-top:155px;padding-bottom:50px;user-select:none}.header-app{position:fixed;top:0;width:100%;max-width:850px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--azul),var(--morado));color:#fff;text-align:center;padding:15px;z-index:2000;box-shadow:0 4px 10px rgba(0,0,0,.2)}.navbar{position:fixed;top:80px;width:100%;max-width:850px;left:50%;transform:translateX(-50%);background:#fff;display:flex;border-bottom:3px solid #cbd5e1;z-index:1999}.nav-item{flex:1;padding:12px 5px;text-align:center;cursor:pointer;font-weight:700;font-size:11px;color:#64748b}.nav-item.active{color:var(--azul);border-bottom:4px solid var(--azul);background:#f8fafc}.container{max-width:850px;margin:0 auto;background:#fff;min-height:80vh;padding:20px;box-shadow:0 0 20px rgba(0,0,0,.05)}.f-group{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:700;color:#334155;font-size:14px}input,select,textarea{width:100%;padding:12px;border:2px solid #cbd5e1;border-radius:8px;font-size:16px}.btn-save{width:100%;padding:16px;background:var(--azul);color:#fff;border:none;border-radius:12px;font-size:18px;font-weight:700;cursor:pointer}.card-reg{border:4px solid #cbd5e1;border-radius:12px;padding:15px;margin-bottom:20px;position:relative;background:#fff}.card-header-btns{position:absolute;top:10px;right:10px;display:flex;gap:5px}.btn-mini{padding:6px 12px;font-size:12px;font-weight:700;border-radius:6px;border:none;cursor:pointer}.btn-edit{background:var(--naranja);color:#000}.btn-del{background:var(--rojo-fuerte);color:#fff}.card-paciente{font-weight:700;color:var(--azul);font-size:14px;margin-bottom:4px}.card-med{font-size:20px;font-weight:800;color:#1e293b;margin-bottom:4px}.card-tipo{color:var(--azul);font-weight:700;font-size:14px;margin-bottom:4px}.card-termino{color:var(--rojo-fuerte);font-weight:900}.card-line{margin-bottom:6px;font-size:14px;color:#334155;display:flex;align-items:baseline;flex-wrap:wrap}.lbl-negrita{font-weight:700;margin-right:5px;color:#000}.val-azul-negrita{font-weight:800;color:var(--azul)}.val-normal{font-weight:400;color:#475569}.val-alarma-style{font-weight:400;color:#000}.card-footer{background:#f8fafc;padding:10px;border-radius:6px;font-size:13px;margin-top:10px;border:1px solid #e2e8f0}.btn-excel{background:var(--verde-ok);color:#fff;border:none;padding:10px 15px;border-radius:8px;font-weight:700;cursor:pointer;font-size:12px;float:right;margin-bottom:15px}@keyframes parpadeoBorde{0%{border-color:var(--rojo-fuerte);box-shadow:0 0 5px var(--rojo-fuerte)}50%{border-color:#ef4444;box-shadow:0 0 15px #ef4444}100%{border-color:var(--rojo-fuerte);box-shadow:0 0 5px var(--rojo-fuerte)}}.msg-bloqueo{color:var(--rojo-fuerte);font-weight:700;text-align:center;margin-bottom:15px;font-size:14px;border:1px solid var(--rojo-fuerte);padding:10px;background:#fff0f0;border-radius:8px}.toma-item{display:flex;align-items:center;padding:15px;border:2px solid #cbd5e1;border-radius:12px;margin-bottom:12px;transition:.3s}.toma-pendiente{background-color:var(--rojo-suave);border-color:#fca5a5}.toma-futura{background-color:var(--amarillo);border-color:#fde047}.toma-marcada{background-color:#f1f5f9;opacity:.6}.toma-marcada .texto-tachado{text-decoration:line-through;text-decoration-style:double;color:var(--gris)}.toma-bloqueada{opacity:.4;pointer-events:none;background:#e2e8f0;filter:grayscale(100%)}.toma-espera{background:#f8fafc;border-color:#cbd5e1;opacity:.8}.contenedor-check{width:42px;height:42px;margin-right:15px;flex-shrink:0;display:flex;align-items:center;justify-content:center}.circulo-vacio{width:100%;height:100%;border-radius:50%;border:3px solid var(--azul);background:#fff;cursor:pointer}.circulo-lleno{width:100%;height:100%;border-radius:50%;border:3px solid var(--verde-ok);background:var(--verde-ok);cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:900}.circulo-disabled{border:3px solid #94a3b8;background:#e2e8f0;cursor:not-allowed}.pendientes-grupo{border:3px dashed var(--rojo-fuerte);padding:15px;border-radius:10px;margin-bottom:15px;background:#fff1f2;display:flex;justify-content:space-between;align-items:center;animation:parpadeoBorde 1.5s infinite}.info-pendiente{flex:1}.titulo-pendiente{font-weight:800;font-size:15px;color:var(--rojo-fuerte);text-transform:uppercase}.sub-pendiente{font-style:italic;font-size:12px;color:#991b1b;margin-top:2px}.hidden{display:none!important}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:3000;align-items:center;justify-content:center;padding:20px}.modal-box{background:#fff;padding:25px;border-radius:20px;width:100%;max-width:380px;text-align:center}.modal-header{font-weight:700;color:#1e293b;margin-bottom:15px;font-size:15px}</style></head><body onclick="activarProtocoloVigilia()"><header class="header-app"><h1>Administrador de Medicamentos</h1><p style="font-size:12px">y/o actividad de salud para adultos mayores</p></header><nav class="navbar"><div class="nav-item active" onclick="nav(0,'sec-add')">‚ûï<br>AGREGAR</div><div class="nav-item" onclick="nav(1,'sec-list')">üìã<br>REGISTROS</div><div class="nav-item" onclick="nav(2,'sec-today')">‚è∞<br>MIS REGISTROS HOY<br>(Y PENDIENTES)</div></nav><div class="container"><div id="sec-add"><input type="hidden" id="edit-id"><div class="f-group"><label>üë§ Nombre del Paciente</label><input type="text" id="paciente" placeholder="Nombre completo"></div><div class="f-group"><label>üíä Medicamento / Actividad</label><input type="text" id="medicina" placeholder="Ej: Losartan"></div><div class="f-group"><label>‚öñÔ∏è Dosis / Detalle</label><input type="text" id="dosis" placeholder="Ej: 1 pastilla"></div><div class="f-group"><label>üõ†Ô∏è Tipo de tratamiento</label><select id="tipo" onchange="toggleTemporal(this.value)"><option value="permanente">Permanente</option><option value="temporal">Temporal</option></select></div><div id="box-dias" class="f-group hidden"><label>üìÖ Duraci√≥n en d√≠as</label><input type="number" id="duracion" value="1" min="1"></div><div class="f-group"><label>üìÖ Fecha Inicio</label><input type="date" id="f-inicio"></div><div class="f-group"><label>üïí Hora Inicio</label><input type="time" id="h-inicio"></div><div class="f-group"><label>üîÑ Frecuencia</label><select id="frecuencia" onchange="toggleFrecDias(this.value)"><option value="4">Cada 4 horas</option><option value="6">Cada 6 horas</option><option value="8">Cada 8 horas</option><option value="12">Cada 12 horas</option><option value="24" selected="selected">Diariamente</option><option value="X-DIAS">Cada (cantidad de) d√≠as</option></select></div><div id="box-frec-dias" class="f-group hidden"><label>üî¢ Cantidad de d√≠as</label><input type="number" id="val-frec-dias" value="2" min="2"></div><div class="f-group"><label>üîî Alarma</label><select id="alarma" onchange="validarAlarma(this)"><option value="Sin alarma">Sin alarma</option><option value="Moderada">Alarma moderada</option><option value="Fuerte">Alarma fuerte</option></select></div><div class="f-group"><label>üìù Notas Adicionales</label><textarea id="notas" rows="2"></textarea></div><button class="btn-save" id="btn-save" onclick="guardarDatos()">üíæ GUARDAR REGISTRO</button></div><div id="sec-list" class="hidden"><button class="btn-excel" onclick="validarExcel()">descarga excel hist√≥rico</button><div id="cont-registros"></div></div><div id="sec-today" class="hidden"><div id="header-fecha" style="font-weight:800;font-size:16px;color:var(--azul);margin-bottom:10px"></div><div id="aviso-bloqueo" class="msg-bloqueo hidden">‚ö†Ô∏è TIENES PENDIENTES DE D√çAS ANTERIORES.<br>M√°rcalos para habilitar las tomas de hoy.</div><div id="cont-pendientes"></div><hr id="hr-sep" style="margin:15px 0;border-top:1px solid #ddd" class="hidden"><div id="cont-hoy"></div></div></div><div id="modal-sec" class="modal"><div class="modal-box"><div id="modal-txt" class="modal-header"></div><input type="password" id="input-clave" placeholder="ingrese clave"><button class="btn-save" style="margin-top:15px;padding:10px;background:var(--verde-ok)" onclick="checkClave()">Validar</button><button class="btn-save" style="margin-top:5px;padding:10px;background:var(--gris)" onclick="cerrarModal()">Cancelar</button></div></div><script>const KEY_MEDS="DB_PILOTO_V1_JPM",KEY_TOMAS="DB_PILOTO_TOMAS_V1_JPM",PASS_SONIDO="SONIDOjpm2026",PASS_EXCEL="HISTORICOjpm2026";let medicinas=JSON.parse(localStorage.getItem(KEY_MEDS)||"[]"),tomas=JSON.parse(localStorage.getItem(KEY_TOMAS)||"{}"),audioCtx=null,wakeLock=null,modoClave="",audioIniciado=!1;document.getElementById("f-inicio").valueAsDate=new Date;async function activarProtocoloVigilia(){if(!audioIniciado){audioCtx||(audioCtx=new(window.AudioContext||window.webkitAudioContext)),"suspended"===audioCtx.state&&await audioCtx.resume();const e=audioCtx.createBuffer(1,1,22050),t=audioCtx.createBufferSource();t.buffer=e,t.loop=!0,t.connect(audioCtx.destination),t.start();try{"wakeLock"in navigator&&(wakeLock=await navigator.wakeLock.request("screen"))}catch(e){}audioIniciado=!0}}function calcularEstadoGlobal(){let e=new Date;return medicinas.some(t=>{if("Sin alarma"===t.alarma)return!1;let a=new Date(t.fIni+"T"+t.hIni);for(;a<=e;){if(!tomas[`${t.id}_${a.getTime()}`])return!0;a=sumarFrecuencia(a,t)}return!1})}function sonarSirena(){if(audioCtx){"suspended"===audioCtx.state&&audioCtx.resume();const e=audioCtx.createOscillator(),t=audioCtx.createGain();e.type="square";const a=audioCtx.currentTime;e.frequency.setValueAtTime(880,a),e.frequency.linearRampToValueAtTime(1200,a+1),e.frequency.linearRampToValueAtTime(880,a+2),e.frequency.linearRampToValueAtTime(1200,a+3),e.frequency.linearRampToValueAtTime(880,a+4),e.frequency.linearRampToValueAtTime(1200,a+5),e.frequency.linearRampToValueAtTime(880,a+6),t.gain.value=.5,e.connect(t),t.connect(audioCtx.destination),e.start(a),e.stop(a+6)}}function nav(e,t){document.querySelectorAll(".container > div").forEach(e=>e.classList.add("hidden")),document.querySelectorAll(".nav-item").forEach(e=>e.classList.remove("active")),document.getElementById(t).classList.remove("hidden"),document.querySelectorAll(".nav-item")[e].classList.add("active"),"sec-list"===t&&renderRegistros(),"sec-today"===t&&renderHoy()}function toggleTemporal(e){document.getElementById("box-dias").classList.toggle("hidden","temporal"!==e)}function toggleFrecDias(e){document.getElementById("box-frec-dias").classList.toggle("hidden","X-DIAS"!==e)}function validarAlarma(e){"Sin alarma"!==e.value&&(modoClave="ALARMA",abrirModal("Clave para activar alarma requerida"))}function guardarDatos(){activarProtocoloVigilia();const e=document.getElementById("edit-id").value,t={id:e?parseInt(e):Date.now(),paciente:document.getElementById("paciente").value,medicina:document.getElementById("medicina").value,dosis:document.getElementById("dosis").value,tipo:document.getElementById("tipo").value,duracion:document.getElementById("duracion").value,fIni:document.getElementById("f-inicio").value,hIni:document.getElementById("h-inicio").value,frec:document.getElementById("frecuencia").value,frecVal:document.getElementById("val-frec-dias").value,alarma:document.getElementById("alarma").value,notas:document.getElementById("notas").value};if(!t.paciente||!t.medicina)return alert("Faltan datos obligatorios");e?medicinas[medicinas.findIndex(t=>t.id==e)]=t:medicinas.push(t),localStorage.setItem(KEY_MEDS,JSON.stringify(medicinas)),resetForm(),nav(1,"sec-list")}function resetForm(){document.getElementById("edit-id").value="",document.getElementById("paciente").value="",document.getElementById("medicina").value="",document.getElementById("btn-save").innerText="üíæ GUARDAR REGISTRO",document.getElementById("alarma").value="Sin alarma"}function renderRegistros(){const e=document.getElementById("cont-registros");e.innerHTML="",medicinas.forEach(t=>{let a="permanente"===t.tipo?"Indefinida":`${t.duracion} d√≠as`,n="";if("temporal"===t.tipo){const e=calcularFin(t);n=` <span class="card-termino">(t√©rmino de tratamiento ${e.f} ${e.h})</span>`}let r="X-DIAS"===t.frec?`Cada ${t.frecVal} d√≠as`:24==t.frec?"Diariamente":`Cada ${t.frec} horas`;e.innerHTML+=`
                <div class="card-reg">
                    <div class="card-header-btns">
                        <button class="btn-mini btn-edit" onclick="editar(${t.id})">Editar</button>
                        <button class="btn-mini btn-del" onclick="eliminar(${t.id})">Eliminar</button>
                    </div>
                    <div class="card-paciente">üë§ ${t.paciente}</div>
                    <div class="card-med">${t.medicina}</div>
                    <div class="card-tipo">Tratamiento ${t.tipo}${n}</div>
                    
                    <div class="card-line"><span class="lbl-negrita">Duraci√≥n:</span> <span class="val-normal">${a}</span></div>
                    <div class="card-line"><span class="lbl-negrita">Dosis:</span> <span class="val-azul-negrita">${t.dosis}</span></div>
                    <div class="card-line"><span class="lbl-negrita">Frecuencia:</span> <span class="val-azul-negrita">${r}</span></div>
                    <div class="card-line"><span class="lbl-negrita">Inicio de tratamiento:</span> <span class="val-normal">${formatoFecha(t.fIni)} ${t.hIni}</span></div>
                    <div class="card-line"><span class="lbl-negrita">Alarma:</span> <span class="val-alarma-style">${t.alarma}</span></div>
                    <div class="card-footer"><span class="lbl-negrita">Notas:</span> <span class="val-azul-negrita">${t.notas||"-"}</span></div>
                </div>`})}function editar(e){const t=medicinas.find(t=>t.id==e);document.getElementById("edit-id").value=t.id,document.getElementById("paciente").value=t.paciente,document.getElementById("medicina").value=t.medicina,document.getElementById("dosis").value=t.dosis,document.getElementById("frecuencia").value=t.frec,document.getElementById("alarma").value=t.alarma,nav(0,"sec-add")}function eliminar(e){confirm("¬øEliminar?")&&(medicinas=medicinas.filter(t=>t.id!==e),localStorage.setItem(KEY_MEDS,JSON.stringify(medicinas)),renderRegistros())}function renderHoy(){activarProtocoloVigilia();const e=new Date;document.getElementById("header-fecha").innerText=`Hoy: ${e.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})}`;const t=document.getElementById("cont-pendientes"),a=document.getElementById("cont-hoy");t.innerHTML="",a.innerHTML="";let n={},r=[],o=!1;medicinas.forEach(t=>{let a=new Date(t.fIni+"T"+t.hIni),l=new Date;l.setDate(l.getDate()-10);let i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59),d=new Date(9999,11,31);"temporal"===t.tipo&&(d=new Date(t.fIni+"T"+t.hIni),d.setDate(d.getDate()+parseInt(t.duracion)));for(;a<=i&&a<=d;){if(a<l){a=sumarFrecuencia(a,t);continue}let l=`${t.id}_${a.getTime()}`,i=a.toLocaleDateString("es-ES");a.toDateString()!==e.toDateString()?tomas[l]||(n[i]||(n[i]=[]),n[i].push(l),o=!0):r.push({id:t.id,med:t.medicina,dosis:t.dosis,pac:t.paciente,hora:new Date(a),key:l}),a=sumarFrecuencia(a,t)}}),Object.keys(n).sort().forEach(e=>{const a=JSON.stringify(n[e]);t.innerHTML+=`
                <div class="pendientes-grupo">
                    <div class="info-pendiente">
                        <div class="titulo-pendiente">PENDIENTES DEL ${e}</div>
                        <div class="sub-pendiente">Marque aqu√≠ para habilitar los medicamentos de hoy</div>
                    </div>
                    <div class="contenedor-check">
                        <div class="circulo-vacio" onclick='marcarGrupo(${a})'></div>
                    </div>
                </div>`}),document.getElementById("aviso-bloqueo").classList.toggle("hidden",!o),document.getElementById("hr-sep").classList.toggle("hidden",!o),r.sort((e,t)=>e.hora-t.hora);let l=o;r.forEach(t=>{const n=tomas[t.key],r=t.hora<e;let o=t.hora-e,i=o/1e3/60>5,d=!1;n||(l?d=!0:i&&(d=!0));let s="",c="";n?(s="toma-marcada",c=`<div class="circulo-lleno" onclick="marcar('${t.key}')">‚úì</div>`):d?(s=i&&!l?"toma-espera":"toma-bloqueada",c='<div class="circulo-vacio circulo-disabled"></div>'):(s=r?"toma-pendiente":"toma-futura",c=`<div class="circulo-vacio" onclick="marcar('${t.key}')"></div>`),a.innerHTML+=`
                <div class="toma-item ${s}">
                    <div class="contenedor-check">
                        ${c}
                    </div>
                    <div>
                        <div class="texto-tachado" style="font-weight:bold; font-size:13px;">${t.hora.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>
                        <div class="texto-tachado" style="font-size:17px; font-weight:800;">${t.med} - ${t.dosis}</div>
                        <div style="font-size:13px; color:var(--gris)">${t.pac}</div>
                    </div>
                </div>`,!n&&r&&(l=!0)})}function sumarFrecuencia(e,t){let a=new Date(e);return"X-DIAS"===t.frec?a.setDate(a.getDate()+parseInt(t.frecVal)):a.setHours(a.getHours()+parseInt(t.frec)),a}function marcar(e){tomas[e]?delete tomas[e]:tomas[e]=!0,localStorage.setItem(KEY_TOMAS,JSON.stringify(tomas)),renderHoy()}function marcarGrupo(e){e.forEach(e=>tomas[e]=!0),localStorage.setItem(KEY_TOMAS,JSON.stringify(tomas)),renderHoy()}function validarExcel(){modoClave="EXCEL",abrirModal("Debe solicitar clave al administrador de esta aplicaci√≥n para ejecutar este mandato")}function abrirModal(e){document.getElementById("modal-txt").innerText=e,document.getElementById("input-clave").value="",document.getElementById("modal-sec").style.display="flex"}function cerrarModal(){document.getElementById("modal-sec").style.display="none","ALARMA"===modoClave&&(document.getElementById("alarma").value="Sin alarma")}function checkClave(){const e=document.getElementById("input-clave").value;"ALARMA"===modoClave&&e===PASS_SONIDO?document.getElementById("modal-sec").style.display="none":"EXCEL"===modoClave&&e===PASS_EXCEL?(document.getElementById("modal-sec").style.display="none",generarExcel()):alert("Clave incorrecta")}function generarExcel(){const e=medicinas.map(e=>{const t="temporal"===e.tipo?calcularFin(e):{f:"Indefinido",h:""};return{"Tipo de tratamiento":e.tipo,"Frecuencia de tratamiento":"X-DIAS"===e.frec?`Cada ${e.frecVal} d√≠as`:`Cada ${e.frec} horas`,"Duraci√≥n de tratamiento":"temporal"===e.tipo?e.duracion+" d√≠as":"Indefinido","Inicio de tratamiento":formatoFecha(e.fIni)+" "+e.hIni,"T√©rmino de tratamiento":t.f+" "+t.h,Paciente:e.paciente,Medicamento:e.medicina,Dosis:e.dosis,Notas:e.notas,Alarma:e.alarma,"Clave Alarma":PASS_SONIDO,"Clave Excel":PASS_EXCEL}}),t=XLSX.utils.json_to_sheet(e);t["!cols"]=Object.keys(e[0]||{}).map(e=>({wch:e.length+5}));const a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,t,"Historial_Salud"),XLSX.writeFile(a,"Historial_Salud_JPM.xlsx")}function formatoFecha(e){if(!e)return"";const[t,a,n]=e.split("-");return`${n}-${a}-${t}`}function calcularFin(e){let t=new Date(e.fIni+"T"+e.hIni);return t.setDate(t.getDate()+parseInt(e.duracion)),{f:formatoFecha(t.toISOString().split("T")[0]),h:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}setInterval(()=>{calcularEstadoGlobal()&&sonarSirena()},8e3);</script></body></html>
